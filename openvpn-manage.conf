##
# Configuration file for openvpn-manage.
# Bash syntax required
# Easyrsa 'vars' file have to be properly setup before
##


## Usually you don't need to change these options
# SERVER_DIR='/etc/openvpn/server'
# KEYS_DIR="${SERVER_DIR}/keys"
# CLIENT_KEYS_DIR="${SERVER_DIR}/client-keys"
# CLIENT_PACKS_DIR="${SERVER_DIR}/client-packs"
# CLIENT_CONFIG_DIR="${SERVER_DIR}/client-configs"
CLIENT_CONFIG_DIR='/etc/openvpn/chroot/ccd'
# USERS_CONF="${SERVER_DIR}/users-config"
SERVER_CONF='/etc/openvpn/udp.server.conf'  # If tcp and udp servers subnet are the same, any config is fine here
# EASYRSA='/etc/openvpn/easy-rsa/easyrsa3'
# CLIENT_OS_DEFAULT='nix'  # 'nix' for Unix-based OS, 'windows' for Windows
# OPENVPN_USER=openvpn
# OPENVPN_GROUP=openvpn

# CA_PASS='no'  # 'yes' if CA is password protected

## Example of variables which can be used in client config options
## You can also use custom variables specified in this file
# CLIENT_CONFIG_DIR=/etc/openvpn/chroot/ccd
# CLIENT_CONFIG_NAME=00008-win-test.conf
# CLIENT_PACKS_DIR=/etc/openvpn/server/client-packs
# CLIENT_KEYS_DIR=/etc/openvpn/server/client-keys
# CLIENT_OS=nix
# CLIENT_OVPN_IP=172.31.240.8
# CLIENT_TYPE=user
# EASYRSA=/etc/openvpn/easy-rsa/easyrsa3
# FIRST_CLIENT_CONFIG_FILE=/etc/openvpn/chroot/ccd/00006-win-test
# FLNUMBER=00008
# HOST_NAME=win-test
# HOST_NAME_ALLOWED_REGEX='^[A-Za-z0-9_-]+$'
# INITIAL_IROUTE_SUBNET=10.10.0.0/29
# KEYS_DIR=/etc/openvpn/server/keys
# LAST_IROUTE_SUBNET_FILE=/etc/openvpn/server/last_iroute_subnet
# N=2
# OPENVPN_GROUP=openvpn
# OPENVPN_USER=openvpn
# OS_SPECIFIC_OPTIONS  # WIN_SPECIFIC_OPTIONS or NIX_SPECIFIC_OPTIONS
# SERVER_CONF=/etc/openvpn/udp.server.conf
# SERVER_DIR=/etc/openvpn/server
# USER=00008-win-test
# USERS_CONF=/etc/openvpn/server/users-config
##

## Client config options
# OS_SPECIFIC_OPTIONS will be replaced to NIX_SPECIFIC_OPTIONS or WIN_SPECIFIC_OPTIONS depends on CLIENT_OS
read -rd '' CLIENT_CONFIG_TEMPLATE <<'EOF'
# OpenVPN 2.4 client ${CLIENT_OS} config file ${N} for host "${HOST_NAME}"

# When  connecting to a remote server do not wait for more than n seconds
# waiting for a response before trying the next server. The default value is 120s.
# This timeout includes proxy and TCP connect timeouts.
server-poll-timeout 12

;remote-random
;local 192.168.1.$((N%245+10))
nobind

<connection>
remote SERVER_IP_HERE 443 udp4
mssfix 1428
</connection>

<connection>
remote SERVER_IP_HERE 443 tcp4
</connection>

client
dev tun
cipher AES-256-GCM
auth SHA256
comp-lzo
resolv-retry infinite
remote-cert-tls server
sndbuf 0
rcvbuf 0
reneg-sec 0
verb 3
mute 10

# For single connection persist-* and user/group options can be uncommented
# For dual it's better to keep them commented, otherwise openvpn cannot
# change connection without full restart
;auth-nocache
persist-key
persist-tun
persist-remote-ip

${OS_SPECIFIC_OPTIONS}

# Certificates and keys
<ca>
$(< "${SERVER_DIR}/keys/ca.crt")
</ca>
<cert>
$(< "${EASYRSA}/pki/issued/${USER}.crt")
</cert>
<key>
$(< "${EASYRSA}/pki/private/${USER}.key")
</key>
key-direction 1
<tls-auth>
$(< "${SERVER_DIR}/keys/ta.key")
</tls-auth>
EOF

# Linux/Mac/BSD/etc specific options (non Windows)
read -rd '' NIX_SPECIFIC_OPTIONS <<'EOF'
# *nix specific options
;user openvpn
;group openvpn
nice 5
;log-append "/var/log/openvpn/${USER}.log"
;ignore-unknown-option block-outside-dns dhcp-renew register-dns tap-sleep dhcp-release dhcp-option
EOF

# Windows specific options
read -rd '' WIN_SPECIFIC_OPTIONS <<'EOF'
# Windows specific options
block-outside-dns
dhcp-renew
register-dns
tap-sleep 1
EOF

## Additional variables
# INITIAL_IROUTE_SUBNET=10.10.0.0/29
# LAST_IROUTE_SUBNET_FILE=${SERVER_DIR}/last_iroute_subnet
# # Warning! Be careful - support of extended range of symbols could lead to script errors or unexpected behavior!
# HOST_NAME_ALLOWED_REGEX='^[A-Za-z0-9_-]+$'  # Regex type of =~ bash operator (extended regular expression)
# ALLOW_DIFFERENT_CLIENT_TYPES_FOR_HOST=no

:  # For succesfull import
